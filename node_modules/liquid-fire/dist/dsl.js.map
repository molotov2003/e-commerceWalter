{"version":3,"file":"dsl.js","sources":["../src/dsl.js"],"sourcesContent":["import { setDefaults } from './animate';\r\nimport Rule from './rule';\r\nimport Constraint from './constraint';\r\nimport Action from './action';\r\n\r\nexport default class DSL {\r\n  constructor(map, constraints) {\r\n    this.map = map;\r\n    this.constraints = constraints;\r\n  }\r\n\r\n  setDefault(props) {\r\n    setDefaults(props);\r\n  }\r\n\r\n  transition() {\r\n    const rule = new Rule();\r\n    const parts = Array.prototype.slice.apply(arguments).reduce(function (\r\n      a,\r\n      b,\r\n    ) {\r\n      return a.concat(b);\r\n    }, []);\r\n\r\n    for (let i = 0; i < parts.length; i++) {\r\n      rule.add(parts[i]);\r\n    }\r\n\r\n    rule.validate(this.map);\r\n    this.constraints.addRule(rule);\r\n  }\r\n\r\n  fromRoute(routeName) {\r\n    return [new Constraint('oldRoute', routeName)];\r\n  }\r\n\r\n  toRoute(routeName) {\r\n    return [new Constraint('newRoute', routeName)];\r\n  }\r\n\r\n  withinRoute(routeName) {\r\n    return this.fromRoute(routeName).concat(this.toRoute(routeName));\r\n  }\r\n\r\n  fromValue(matcher) {\r\n    return [new Constraint('oldValue', matcher)];\r\n  }\r\n\r\n  toValue(matcher) {\r\n    return [new Constraint('newValue', matcher)];\r\n  }\r\n\r\n  betweenValues(matcher) {\r\n    return this.fromValue(matcher).concat(this.toValue(matcher));\r\n  }\r\n\r\n  fromModel(matcher) {\r\n    return [new Constraint('oldModel', matcher)];\r\n  }\r\n\r\n  toModel(matcher) {\r\n    return [new Constraint('newModel', matcher)];\r\n  }\r\n\r\n  betweenModels(matcher) {\r\n    return this.fromModel(matcher).concat(this.toModel(matcher));\r\n  }\r\n\r\n  hasClass(name) {\r\n    return new Constraint('parentElementClass', name);\r\n  }\r\n\r\n  matchSelector(selector) {\r\n    return new Constraint('parentElement', function (elt) {\r\n      return matches(elt, selector);\r\n    });\r\n  }\r\n\r\n  childOf(selector) {\r\n    return this.matchSelector(selector + ' > *');\r\n  }\r\n\r\n  use(nameOrHandler, ...args) {\r\n    return new Action(nameOrHandler, args);\r\n  }\r\n\r\n  reverse(nameOrHandler, ...args) {\r\n    return new Action(nameOrHandler, args, { reversed: true });\r\n  }\r\n\r\n  useAndReverse(nameOrHandler, ...args) {\r\n    return [\r\n      this.use(nameOrHandler, ...args),\r\n      this.reverse(nameOrHandler, ...args),\r\n    ];\r\n  }\r\n\r\n  onInitialRender() {\r\n    return new Constraint('firstTime', 'yes');\r\n  }\r\n\r\n  includingInitialRender() {\r\n    return new Constraint('firstTime', ['yes', 'no']);\r\n  }\r\n\r\n  inHelper(...names) {\r\n    return new Constraint('helperName', names);\r\n  }\r\n\r\n  outletName(...names) {\r\n    return new Constraint('outletName', names);\r\n  }\r\n\r\n  media(query) {\r\n    return new Constraint('media', function () {\r\n      return window.matchMedia(query).matches;\r\n    });\r\n  }\r\n\r\n  debug() {\r\n    return 'debug';\r\n  }\r\n}\r\n\r\nfunction matches(elt, s) {\r\n  if (Element.prototype.matches) {\r\n    return elt.matches(s);\r\n  } else {\r\n    const matches = (elt.document || elt.ownerDocument).querySelectorAll(s);\r\n    let i = matches.length;\r\n    // eslint-disable-next-line no-empty\r\n    while (--i >= 0 && matches.item(i) !== elt) {}\r\n    return i > -1;\r\n  }\r\n}\r\n"],"names":["DSL","constructor","map","constraints","setDefault","props","setDefaults","transition","rule","Rule","parts","Array","prototype","slice","apply","arguments","reduce","a","b","concat","i","length","add","validate","addRule","fromRoute","routeName","Constraint","toRoute","withinRoute","fromValue","matcher","toValue","betweenValues","fromModel","toModel","betweenModels","hasClass","name","matchSelector","selector","elt","matches","childOf","use","nameOrHandler","args","Action","reverse","reversed","useAndReverse","onInitialRender","includingInitialRender","inHelper","names","outletName","media","query","window","matchMedia","debug","s","Element","document","ownerDocument","querySelectorAll","item"],"mappings":"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"}