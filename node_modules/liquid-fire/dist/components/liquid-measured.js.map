{"version":3,"file":"liquid-measured.js","sources":["../../src/components/liquid-measured.hbs.js","../../src/components/liquid-measured.js"],"sourcesContent":["import { precompileTemplate } from \"@ember/template-compilation\";\nexport default precompileTemplate(\"<div\\r\\n\t{{did-insert this.setup}}\\r\\n\t{{will-destroy this.destroyElement}}\\r\\n>\\r\\n\t{{yield}}\\r\\n</div>\\r\\n\")","import { next, throttle } from '@ember/runloop';\r\nimport { inject as service } from '@ember/service';\r\nimport { bind } from '@ember/runloop';\r\nimport Component from '@glimmer/component';\r\nimport { MutationObserver } from '../index';\r\nimport { action } from '@ember/object';\r\nimport { measure } from '../utils/animate';\r\n\r\nconst WINDOW_RESIZE_THROTTLE_DURATION = 100;\r\n\r\nexport default class LiquidMeasuredComponent extends Component {\r\n  constructor() {\r\n    super(...arguments);\r\n\r\n    // this._destroyOnUnload = bind(this, this._destroyOnUnload);\r\n  }\r\n\r\n  @action\r\n  setup(element) {\r\n    this.element = element;\r\n\r\n    const self = this;\r\n\r\n    // This prevents margin collapse\r\n    this.element.style.overflow = 'auto';\r\n\r\n    this.didMutate();\r\n\r\n    this.observer = new MutationObserver(function (mutations) {\r\n      self.didMutate(mutations);\r\n    });\r\n    this.observer.observe(this.element, {\r\n      attributes: true,\r\n      subtree: true,\r\n      childList: true,\r\n      characterData: true,\r\n    });\r\n\r\n    this.windowResizeHandler = bind(this, this.windowDidResize);\r\n    window.addEventListener('resize', this.windowResizeHandler);\r\n\r\n    this.element.addEventListener('webkitTransitionEnd', function () {\r\n      self.didMutate();\r\n    });\r\n    // Chrome Memory Leak: https://bugs.webkit.org/show_bug.cgi?id=93661\r\n    // window.addEventListener('unload', this._destroyOnUnload);\r\n  }\r\n\r\n  @action\r\n  destroyElement() {\r\n    if (this.observer) {\r\n      this.observer.disconnect();\r\n    }\r\n    window.removeEventListener('resize', this.windowResizeHandler);\r\n    // window.removeEventListener('unload', this._destroyOnUnload);\r\n  }\r\n\r\n  @service('liquid-fire-transitions') transitionMap;\r\n\r\n  didMutate() {\r\n    // by incrementing the running transitions counter here we prevent\r\n    // tests from falling through the gap between the time they\r\n    // triggered mutation the time we may actually animate in\r\n    // response.\r\n    const tmap = this.transitionMap;\r\n    tmap.incrementRunningTransitions();\r\n    next(this, function () {\r\n      this._didMutate();\r\n      tmap.decrementRunningTransitions();\r\n    });\r\n  }\r\n\r\n  windowDidResize() {\r\n    throttle(this, this.didMutate, WINDOW_RESIZE_THROTTLE_DURATION);\r\n  }\r\n\r\n  _didMutate() {\r\n    if (!this.element) {\r\n      return;\r\n    }\r\n    this.args.didMeasure(measure(this.element));\r\n  }\r\n\r\n  // _destroyOnUnload() {\r\n  //   this.willDestroyElement();\r\n  // }\r\n}\r\n"],"names":["precompileTemplate","WINDOW_RESIZE_THROTTLE_DURATION","LiquidMeasuredComponent","_dec","service","_class","Component","constructor","arguments","_initializerDefineProperty","_descriptor","setup","element","self","style","overflow","didMutate","observer","MutationObserver","mutations","observe","attributes","subtree","childList","characterData","windowResizeHandler","bind","windowDidResize","window","addEventListener","destroyElement","disconnect","removeEventListener","tmap","transitionMap","incrementRunningTransitions","next","_didMutate","decrementRunningTransitions","throttle","args","didMeasure","measure","_applyDecoratedDescriptor","prototype","action","Object","getOwnPropertyDescriptor","configurable","enumerable","writable","initializer","setComponentTemplate","TEMPLATE"],"mappings":"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"}