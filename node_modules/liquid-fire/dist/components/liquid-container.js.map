{"version":3,"file":"liquid-container.js","sources":["../../src/components/liquid-container.hbs.js","../../src/components/liquid-container.js"],"sourcesContent":["import { precompileTemplate } from \"@ember/template-compilation\";\nexport default precompileTemplate(\"<div class=\\\"liquid-container {{@class}}\\\" ...attributes {{did-insert this.setup}}>\\r\\n\t{{~yield this~}}\\r\\n</div>\")","import Component from '@glimmer/component';\r\nimport { inject as service } from '@ember/service';\r\nimport { action } from '@ember/object';\r\nimport { measure, animateGrowth } from '../utils/animate';\r\nimport './liquid-container.css';\r\n\r\nexport default class LiquidContainerComponent extends Component {\r\n  @service('liquid-fire-transitions') transitionMap;\r\n\r\n  _wasInserted = false;\r\n  element = null;\r\n\r\n  get growDuration() {\r\n    return this.args.growDuration || 250;\r\n  }\r\n\r\n  get growPixelsPerSecond() {\r\n    return this.args.growPixelsPerSecond || 200;\r\n  }\r\n\r\n  get growEasing() {\r\n    return this.args.growEasing || 'slide';\r\n  }\r\n\r\n  get shrinkDelay() {\r\n    return this.args.shrinkDelay || 0;\r\n  }\r\n\r\n  get growDelay() {\r\n    return this.args.growDelay || 0;\r\n  }\r\n\r\n  get growWidth() {\r\n    return this.args.growWidth !== undefined ? this.args.growWidth : true;\r\n  }\r\n\r\n  get growHeight() {\r\n    return this.args.growHeight !== undefined ? this.args.growHeight : true;\r\n  }\r\n\r\n  @action\r\n  setup(element) {\r\n    this.element = element;\r\n    this._wasInserted = true;\r\n  }\r\n\r\n  @action\r\n  willTransition(versions) {\r\n    if (!this._wasInserted) {\r\n      return;\r\n    }\r\n\r\n    // Remember our own size before anything changes\r\n    this._cachedSize = measure(this.element);\r\n\r\n    // And make any children absolutely positioned with fixed sizes.\r\n    for (let i = 0; i < versions.length; i++) {\r\n      goAbsolute(versions[i]);\r\n    }\r\n  }\r\n\r\n  @action\r\n  afterChildInsertion(versions) {\r\n    const elt = this.element;\r\n    const enableGrowth = this.args.enableGrowth !== false;\r\n\r\n    // Measure children\r\n    const sizes = [];\r\n    for (let i = 0; i < versions.length; i++) {\r\n      if (versions[i].view) {\r\n        sizes[i] = measure(versions[i].view.element);\r\n      }\r\n    }\r\n\r\n    // Measure ourself again to see how big the new children make\r\n    // us.\r\n    const want = measure(elt);\r\n    const have = this._cachedSize || want;\r\n\r\n    // Make ourself absolute\r\n    if (enableGrowth) {\r\n      this.lockSize(elt, have);\r\n    } else {\r\n      this.lockSize(elt, {\r\n        height: Math.max(want.height, have.height),\r\n        width: Math.max(want.width, have.width),\r\n      });\r\n    }\r\n\r\n    // Apply '.liquid-animating' to liquid-container allowing\r\n    // any customizable CSS control while an animating is occuring\r\n    this.updateAnimatingClass(true);\r\n\r\n    // Make the children absolute and fixed size.\r\n    for (let i = 0; i < versions.length; i++) {\r\n      goAbsolute(versions[i], sizes[i]);\r\n    }\r\n\r\n    // Kick off our growth animation\r\n    if (enableGrowth) {\r\n      this._scaling = this.animateGrowth(elt, have, want);\r\n    }\r\n  }\r\n\r\n  @action\r\n  afterTransition(versions) {\r\n    for (let i = 0; i < versions.length; i++) {\r\n      goStatic(versions[i]);\r\n    }\r\n    this.unlockSize();\r\n  }\r\n\r\n  animateGrowth(elt, have, want) {\r\n    return animateGrowth(\r\n      elt,\r\n      have,\r\n      want,\r\n      this.transitionMap,\r\n      this.growWidth,\r\n      this.growHeight,\r\n      this.growEasing,\r\n      this.shrinkDelay,\r\n      this.growDelay,\r\n      this.growDuration,\r\n      this.growPixelsPerSecond,\r\n    );\r\n  }\r\n\r\n  lockSize(elt, want) {\r\n    elt.style.width = `${want.width}px`;\r\n    elt.style.height = `${want.height}px`;\r\n  }\r\n\r\n  unlockSize() {\r\n    const doUnlock = () => {\r\n      this.updateAnimatingClass(false);\r\n      if (this.element) {\r\n        this.element.style.width = '';\r\n        this.element.style.height = '';\r\n      }\r\n    };\r\n    if (this._scaling) {\r\n      this._scaling.then(doUnlock);\r\n    } else {\r\n      doUnlock();\r\n    }\r\n  }\r\n\r\n  // We're doing this manually instead of via classNameBindings\r\n  // because it depends on upward-data-flow, which generates warnings\r\n  // under Glimmer.\r\n  updateAnimatingClass(on) {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n    if (on) {\r\n      this.element.classList.add('liquid-animating');\r\n    } else {\r\n      this.element.classList.remove('liquid-animating');\r\n    }\r\n  }\r\n}\r\n\r\nfunction goAbsolute(version, size) {\r\n  if (!version.view) {\r\n    return;\r\n  }\r\n  const elt = version.view.element;\r\n  const pos = {\r\n    top: elt.offsetTop,\r\n    left: elt.offsetLeft,\r\n  };\r\n  if (!size) {\r\n    size = measure(elt);\r\n  }\r\n  elt.style.width = `${size.width}px`;\r\n  elt.style.height = `${size.height}px`;\r\n  elt.style.position = 'absolute';\r\n  elt.style.top = `${pos.top}px`;\r\n  elt.style.left = `${pos.left}px`;\r\n}\r\n\r\nfunction goStatic(version) {\r\n  if (version.view && !version.view.isDestroyed) {\r\n    const elt = version.view.element;\r\n    elt.style.width = '';\r\n    elt.style.height = '';\r\n    elt.style.position = '';\r\n  }\r\n}\r\n"],"names":["precompileTemplate","LiquidContainerComponent","_dec","service","_class","Component","constructor","args","_initializerDefineProperty","_descriptor","_defineProperty","growDuration","growPixelsPerSecond","growEasing","shrinkDelay","growDelay","growWidth","undefined","growHeight","setup","element","_wasInserted","willTransition","versions","_cachedSize","measure","i","length","goAbsolute","afterChildInsertion","elt","enableGrowth","sizes","view","want","have","lockSize","height","Math","max","width","updateAnimatingClass","_scaling","animateGrowth","afterTransition","goStatic","unlockSize","transitionMap","style","doUnlock","then","on","isDestroyed","classList","add","remove","_applyDecoratedDescriptor","prototype","configurable","enumerable","writable","initializer","action","Object","getOwnPropertyDescriptor","version","size","pos","top","offsetTop","left","offsetLeft","position","setComponentTemplate","TEMPLATE"],"mappings":"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"}