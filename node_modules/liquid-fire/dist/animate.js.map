{"version":3,"file":"animate.js","sources":["../src/animate.js"],"sourcesContent":["/* jshint newcap: false */\r\nimport Promise from './promise';\r\nimport { Velocity } from './velocity-ext';\r\n\r\n// Make sure Velocity always has promise support by injecting our own\r\n// RSVP-based implementation if it doesn't already have one.\r\nif (!Velocity.Promise) {\r\n  Velocity.Promise = Promise;\r\n}\r\n\r\n// Velocity's tick() defaults to RAF's high resolution timestamp. If the browser\r\n// is under high stress the RAF timestamp may have a significant offset which\r\n// can result in dropping a large chunk of frames. Because of this, the use of\r\n// the RAF timestamp should be opt-in.\r\nVelocity.timestamp = false;\r\n\r\nexport function animate(elt, props, opts, label) {\r\n  // These numbers are just sane defaults in the probably-impossible\r\n  // case where somebody tries to read our state before the first\r\n  // 'progress' callback has fired.\r\n  const state = { percentComplete: 0, timeRemaining: 100, timeSpent: 0 };\r\n\r\n  if (!elt) {\r\n    return Promise.resolve();\r\n  }\r\n\r\n  if (!opts) {\r\n    opts = {};\r\n  } else {\r\n    opts = { ...opts };\r\n  }\r\n\r\n  // By default, we ask velocity to clear the element's `display`\r\n  // and `visibility` properties at the start of animation. Our\r\n  // animated divs are all initially rendered with `display:none`\r\n  // and `visibility:hidden` to prevent a flash of before-animated\r\n  // content.\r\n  if (typeof opts.display === 'undefined') {\r\n    opts.display = '';\r\n  }\r\n  if (typeof opts.visibility === 'undefined') {\r\n    opts.visibility = '';\r\n  }\r\n\r\n  if (opts.progress) {\r\n    throw new Error(\r\n      \"liquid-fire's 'animate' function reserves the use of Velocity's 'progress' option for its own nefarious purposes.\",\r\n    );\r\n  }\r\n\r\n  opts.progress = function () {\r\n    state.percentComplete = arguments[1];\r\n    state.timeRemaining = arguments[2];\r\n    state.timeSpent = state.timeRemaining / (1 / state.percentComplete - 1);\r\n  };\r\n\r\n  state.promise = Promise.resolve(Velocity.animate(elt, props, opts));\r\n\r\n  if (label) {\r\n    state.promise = state.promise.then(\r\n      function () {\r\n        clearLabel(elt, label);\r\n      },\r\n      function (err) {\r\n        clearLabel(elt, label);\r\n        throw err;\r\n      },\r\n    );\r\n    applyLabel(elt, label, state);\r\n  }\r\n\r\n  return state.promise;\r\n}\r\n\r\nexport function stop(elt) {\r\n  if (elt) {\r\n    Velocity(elt, 'stop', true);\r\n  }\r\n}\r\n\r\nexport function setDefaults(props) {\r\n  for (const key in props) {\r\n    if (Object.hasOwnProperty.call(props, key)) {\r\n      if (key === 'progress') {\r\n        throw new Error(\r\n          \"liquid-fire's 'animate' function reserves the use of Velocity's '\" +\r\n            key +\r\n            \"' option for its own nefarious purposes.\",\r\n        );\r\n      }\r\n      Velocity.defaults[key] = props[key];\r\n    }\r\n  }\r\n}\r\n\r\nexport function isAnimating(elt, animationLabel) {\r\n  return elt && data(elt, 'lfTags_' + animationLabel);\r\n}\r\n\r\nexport function finish(elt, animationLabel) {\r\n  return stateForLabel(elt, animationLabel).promise;\r\n}\r\n\r\nexport function timeSpent(elt, animationLabel) {\r\n  return stateForLabel(elt, animationLabel).timeSpent;\r\n}\r\n\r\nexport function timeRemaining(elt, animationLabel) {\r\n  return stateForLabel(elt, animationLabel).timeRemaining;\r\n}\r\n\r\nfunction stateForLabel(elt, label) {\r\n  const state = isAnimating(elt, label);\r\n  if (!state) {\r\n    throw new Error('no animation labeled ' + label + ' is in progress');\r\n  }\r\n  return state;\r\n}\r\n\r\nfunction applyLabel(elt, label, state) {\r\n  if (elt) {\r\n    data(elt, 'lfTags_' + label, state);\r\n  }\r\n}\r\n\r\nfunction clearLabel(elt, label) {\r\n  if (elt) {\r\n    data(elt, 'lfTags_' + label, null);\r\n  }\r\n}\r\n\r\nconst DATA_STORAGE = {};\r\n\r\nfunction data(obj, key, val) {\r\n  if (!obj) {\r\n    return DATA_STORAGE;\r\n  } else if (!key) {\r\n    if (!(obj in DATA_STORAGE)) {\r\n      return {};\r\n    }\r\n    return DATA_STORAGE[obj];\r\n  } else if (arguments.length < 3) {\r\n    if (!(obj in DATA_STORAGE)) {\r\n      return undefined;\r\n    }\r\n    return DATA_STORAGE[obj][key];\r\n  } else {\r\n    if (!(obj in DATA_STORAGE)) {\r\n      DATA_STORAGE[obj] = {};\r\n    }\r\n    DATA_STORAGE[obj][key] = val;\r\n  }\r\n}\r\n"],"names":["Velocity","Promise","timestamp","animate","elt","props","opts","label","state","percentComplete","timeRemaining","timeSpent","resolve","display","visibility","progress","Error","arguments","promise","then","clearLabel","err","applyLabel","stop","setDefaults","key","Object","hasOwnProperty","call","defaults","isAnimating","animationLabel","data","finish","stateForLabel","DATA_STORAGE","obj","val","length","undefined"],"mappings":"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"}