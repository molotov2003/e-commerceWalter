{"version":3,"file":"rule.js","sources":["../src/rule.js"],"sourcesContent":["import { A } from '@ember/array';\r\nimport Action from './action';\r\nimport Constraint from './constraint';\r\n\r\nexport default class Rule {\r\n  constructor() {\r\n    this.constraints = A();\r\n    this.use = null;\r\n    this.reverse = null;\r\n  }\r\n\r\n  add(thing) {\r\n    if (thing instanceof Action) {\r\n      let prop = 'use';\r\n      if (thing.reversed) {\r\n        prop = 'reverse';\r\n      }\r\n      if (this[prop]) {\r\n        throw new Error(\r\n          `More than one \"${prop}\" statement in the same transition rule is not allowed`,\r\n        );\r\n      }\r\n      this[prop] = thing;\r\n    } else if (thing === 'debug') {\r\n      this.debug = true;\r\n    } else {\r\n      this.constraints.push(thing);\r\n    }\r\n  }\r\n\r\n  validate(transitionMap) {\r\n    if (!this.use) {\r\n      throw new Error(`Every transition rule must include a \"use\" statement`);\r\n    }\r\n    this.use.validateHandler(transitionMap);\r\n    if (this.reverse) {\r\n      this.reverse.validateHandler(transitionMap);\r\n    }\r\n    if (!this.constraints.find((c) => c.target === 'firstTime')) {\r\n      this.constraints.push(new Constraint('firstTime', 'no'));\r\n    }\r\n  }\r\n\r\n  invert() {\r\n    const rule = new this.constructor();\r\n    rule.use = this.reverse;\r\n    rule.reverse = this.use;\r\n    rule.constraints = this.constraints.map((c) => c.invert());\r\n    rule.debug = this.debug;\r\n    return rule;\r\n  }\r\n}\r\n"],"names":["Rule","constructor","constraints","A","use","reverse","add","thing","Action","prop","reversed","Error","debug","push","validate","transitionMap","validateHandler","find","c","target","Constraint","invert","rule","map"],"mappings":";;;;AAIe,MAAMA,IAAI,CAAC;AACxBC,EAAAA,WAAWA,GAAG;AACZ,IAAA,IAAI,CAACC,WAAW,GAAGC,CAAC,EAAE,CAAA;IACtB,IAAI,CAACC,GAAG,GAAG,IAAI,CAAA;IACf,IAAI,CAACC,OAAO,GAAG,IAAI,CAAA;AACrB,GAAA;EAEAC,GAAGA,CAACC,KAAK,EAAE;IACT,IAAIA,KAAK,YAAYC,MAAM,EAAE;MAC3B,IAAIC,IAAI,GAAG,KAAK,CAAA;MAChB,IAAIF,KAAK,CAACG,QAAQ,EAAE;AAClBD,QAAAA,IAAI,GAAG,SAAS,CAAA;AAClB,OAAA;AACA,MAAA,IAAI,IAAI,CAACA,IAAI,CAAC,EAAE;AACd,QAAA,MAAM,IAAIE,KAAK,CACZ,CAAiBF,eAAAA,EAAAA,IAAK,wDACzB,CAAC,CAAA;AACH,OAAA;AACA,MAAA,IAAI,CAACA,IAAI,CAAC,GAAGF,KAAK,CAAA;AACpB,KAAC,MAAM,IAAIA,KAAK,KAAK,OAAO,EAAE;MAC5B,IAAI,CAACK,KAAK,GAAG,IAAI,CAAA;AACnB,KAAC,MAAM;AACL,MAAA,IAAI,CAACV,WAAW,CAACW,IAAI,CAACN,KAAK,CAAC,CAAA;AAC9B,KAAA;AACF,GAAA;EAEAO,QAAQA,CAACC,aAAa,EAAE;AACtB,IAAA,IAAI,CAAC,IAAI,CAACX,GAAG,EAAE;AACb,MAAA,MAAM,IAAIO,KAAK,CAAE,CAAA,oDAAA,CAAqD,CAAC,CAAA;AACzE,KAAA;AACA,IAAA,IAAI,CAACP,GAAG,CAACY,eAAe,CAACD,aAAa,CAAC,CAAA;IACvC,IAAI,IAAI,CAACV,OAAO,EAAE;AAChB,MAAA,IAAI,CAACA,OAAO,CAACW,eAAe,CAACD,aAAa,CAAC,CAAA;AAC7C,KAAA;AACA,IAAA,IAAI,CAAC,IAAI,CAACb,WAAW,CAACe,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,MAAM,KAAK,WAAW,CAAC,EAAE;AAC3D,MAAA,IAAI,CAACjB,WAAW,CAACW,IAAI,CAAC,IAAIO,UAAU,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC,CAAA;AAC1D,KAAA;AACF,GAAA;AAEAC,EAAAA,MAAMA,GAAG;AACP,IAAA,MAAMC,IAAI,GAAG,IAAI,IAAI,CAACrB,WAAW,EAAE,CAAA;AACnCqB,IAAAA,IAAI,CAAClB,GAAG,GAAG,IAAI,CAACC,OAAO,CAAA;AACvBiB,IAAAA,IAAI,CAACjB,OAAO,GAAG,IAAI,CAACD,GAAG,CAAA;AACvBkB,IAAAA,IAAI,CAACpB,WAAW,GAAG,IAAI,CAACA,WAAW,CAACqB,GAAG,CAAEL,CAAC,IAAKA,CAAC,CAACG,MAAM,EAAE,CAAC,CAAA;AAC1DC,IAAAA,IAAI,CAACV,KAAK,GAAG,IAAI,CAACA,KAAK,CAAA;AACvB,IAAA,OAAOU,IAAI,CAAA;AACb,GAAA;AACF;;;;"}